# Apstra Configlets
## What is it ?

- Apstra automates the creation and management of Leaf/Spine IP Fabrics. Apstra derives a validated configuration as part of the Intent based abstraction model which addresses the large part of the VXLAN EVPN reference design. For any configuration that lives outside of the Apstra reference design, a feature known as a ‘Configlet’ can be used. A configlet allows the operator to create configuration templates and have them automatically deployed to devices based on the Intent. The configlet management system is designed to support multiple vendor and syntax types.

## How to design a configlet ?

- Often, you will use Property-Sets which is a key/value store used to hold user-defined configuraiton variables. The logic is to seperate the configuraiton logic (Configlets) from the configuraiton variables (Property-Sets). To be more specific variables can come from two sources: User-defined variables, coming from Property-Sets as previously mentioned and Blueprint-derived vairbales, coming from the Device-Context. Some configlets uses none, one or both of these.
- The overall goal when desinging the configlet is to strive to make it as dynamic and as zero-touch as possible. In other words, make it such that the configlet will be written once, and all Day-2 operaitons to not require a configlet change, which is often a disruptive operaiton in the Blueprint. Instead Day-2 changes can be driven by Property-Set updates (not a disruptive operaiton), Tags updates or similar blueprint type changes which will result in a change to the Device-Context and ultimatly to the configlet.


## How to contribute  ?

- Create a directory under the vendor: `Juniper`, `Cisco` or `Arista`, name it after what the configlet is doing and add a hyperlink to it from the vendor's README page.
- Under that folder create 
  - a `README.MD` with two sections:
    - A use-case section describing at a high-level why this configlet, include any related documentation pointers and any useful information (Ex: Applying this configlet flaps your BGP peering, or applying this configlet requires a pfe reboot).
    - A configlet description presented the content of the configlet formatted with Jinja hilighting. This is used for readabily purposes only, because reading the configlet from the JSON is not easy.
  - A JSON file containing the configlet definition. The file must be named `CFG_<configlet_name>.json` and contain three keys `display_name`, `ref_archs` and `generators`. If you are using a `GET` API call to obtain the configlet remove fields unnecessary for the `POST` which are `id`, `created_at` and `last_modified_at`, these fields should be auto-generated by the backend during the configlet creation. This file is used for two aspects: 1) Allows a user to quickly import the configlet in his enviroement and play with it, and 2) leverage automation for continuous testing of the configlet push in an Apstra server (to check things like Device-Context compatibility).
  - (Optionnaly) A JSON file containing the Property-Set definition. The file must be named `PS_<configlet_name>.json` and contain one key nameed after the `<configlet_name>` to connect it with the way the Configlet is referencing the Jinja variables for accessing the Property-Set. If you are using a `GET` API call to obtain the Property-Set remove fields unnecessary for the `POST` which are `id`, `created_at` and `last_modified_at`, these fields should be auto-generated by the backend during the Property-Set creation. 


## POSTMAN
There is a postman collection included in the base directory that will provide API access to the configlets that mirrors the directories and configlets, so you will easily be able to push any given configlet to the chosen Apstra API via REST.